set(BOOTLOADER_STAGE1_ASM_SOURCE main.asm)
set(BOOTLOADER_STAGE1_BIN_NAME boot_stage1.bin)

add_custom_command(
    OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/${BOOTLOADER_STAGE1_BIN_NAME}"
    COMMAND nasm -f bin "${CMAKE_CURRENT_SOURCE_DIR}/${BOOTLOADER_STAGE1_ASM_SOURCE}" -o "${CMAKE_CURRENT_BINARY_DIR}/${BOOTLOADER_STAGE1_BIN_NAME}"
    DEPENDS "${BOOTLOADER_STAGE1_ASM_SOURCE}"
    COMMENT "Assembling ${BOOTLOADER_STAGE1_ASM_SOURCE} directly to raw binary ${BOOTLOADER_STAGE1_BIN_NAME}"
)

add_custom_target(bootloader_stage1_bin ALL
    DEPENDS "${CMAKE_CURRENT_BINARY_DIR}/${BOOTLOADER_STAGE1_BIN_NAME}"
)

message(STATUS "Configuring Bootloader Stage 1: ${BOOTLOADER_STAGE1_ASM_SOURCE} -> ${BOOTLOADER_STAGE1_BIN_NAME}")